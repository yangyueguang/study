# ä¸€ã€ç»ˆç«¯å¿«æ·é”®
å¿«æ·é”® | åŠŸèƒ½
--- | ---
Ctrl + a/Home |åˆ‡æ¢åˆ°å‘½ä»¤è¡Œå¼€å§‹
Ctrl + e/End |åˆ‡æ¢åˆ°å‘½ä»¤è¡Œæœ«å°¾
Ctrl + l |æ¸…é™¤å±å¹•å†…å®¹ï¼Œæ•ˆæœç­‰åŒäº clear
Ctrl + u |æ¸…é™¤å‰ªåˆ‡å…‰æ ‡ä¹‹å‰çš„å†…å®¹
Ctrl + k |å‰ªåˆ‡æ¸…é™¤å…‰æ ‡ä¹‹åçš„å†…å®¹
Ctrl + y |ç²˜è´´åˆšæ‰æ‰€åˆ é™¤çš„å­—ç¬¦
Ctrl + r |åœ¨å†å²å‘½ä»¤ä¸­æŸ¥æ‰¾ (è¿™ä¸ªéå¸¸å¥½ç”¨ï¼Œè¾“å…¥å…³é”®å­—å°±è°ƒå‡ºä»¥å‰çš„å‘½ä»¤äº†)
Ctrl + c |ç»ˆæ­¢å‘½ä»¤
ctrl + o |é‡å¤æ‰§è¡Œå‘½ä»¤
Ctrl + d |é€€å‡º shellï¼Œlogout
Ctrl + z |è½¬å…¥åå°è¿è¡Œ,ä½†åœ¨å½“å‰ç”¨æˆ·é€€å‡ºåå°±ä¼šç»ˆæ­¢
Ctrl + t |é¢ å€’å…‰æ ‡æ‰€åœ¨å¤„åŠå…¶ä¹‹å‰çš„å­—ç¬¦ä½ç½®ï¼Œå¹¶å°†å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦
Alt + t |äº¤æ¢å½“å‰ä¸ä»¥å‰å•è¯çš„ä½ç½®
Alt + d |å‰ªåˆ‡å…‰æ ‡ä¹‹åçš„è¯
Ctrl+w |å‰ªåˆ‡å…‰æ ‡æ‰€åœ¨å¤„ä¹‹å‰çš„ä¸€ä¸ªè¯(ä»¥ç©ºæ ¼ã€æ ‡ç‚¹ç­‰ä¸ºåˆ†éš”ç¬¦)
Ctrl+(x u) |æŒ‰ä½ Ctrl çš„åŒæ—¶å†å…ˆåæŒ‰ x å’Œ uï¼Œæ’¤é”€åˆšæ‰çš„æ“ä½œ
Ctrl+s |é”ä½ç»ˆç«¯
Ctrl+q |è§£é”ç»ˆç«¯
!! |é‡å¤æ‰§è¡Œæœ€åä¸€æ¡å‘½ä»¤
history |æ˜¾ç¤ºä½ æ‰€æœ‰æ‰§è¡Œè¿‡çš„ç¼–å·+å†å²å‘½ä»¤ã€‚è¿™ä¸ªå¯ä»¥é…åˆ!ç¼–è¾‘æ¥æ‰§è¡ŒæŸæŸå‘½ä»¤
!$ |æ˜¾ç¤ºç³»ç»Ÿæœ€è¿‘çš„ä¸€æ¡å‚æ•°
lsof -i:8000| æŸ¥çœ‹8000ç«¯å£çš„æœåŠ¡
Shutdown Reboot Halt poweroff  | å…³æœºå’Œé‡å¯å‘½ä»¤
uptime | å¼€æœºå¤šä¹…äº†

# äºŒã€ç¯å¢ƒå˜é‡

ç¯å¢ƒå˜é‡|è¯´æ˜
---|---
PATH|å†³å®šäº† shell å°†åˆ°å“ªäº›ç›®å½•ä¸­å¯»æ‰¾å‘½ä»¤æˆ–ç¨‹åº
HOME|å½“å‰ç”¨æˆ·ä¸»ç›®å½•
MAIL|æ˜¯æŒ‡å½“å‰ç”¨æˆ·çš„é‚®ä»¶å­˜æ”¾ç›®å½•ã€‚
SHELL|æ˜¯æŒ‡å½“å‰ç”¨æˆ·ç”¨çš„æ˜¯å“ªç§ Shellã€‚
HISTSIZE|æ˜¯æŒ‡ä¿å­˜å†å²å‘½ä»¤è®°å½•çš„æ¡æ•°ã€‚
LOGNAME|æ˜¯æŒ‡å½“å‰ç”¨æˆ·çš„ç™»å½•åã€‚
HOSTNAME|æ˜¯æŒ‡ä¸»æœºçš„åç§°ï¼Œè®¸å¤šåº”ç”¨ç¨‹åºå¦‚æœè¦ç”¨åˆ°ä¸»æœºåçš„è¯ï¼Œé€šå¸¸æ˜¯ä»è¿™ä¸ªç¯å¢ƒå˜é‡ä¸­æ¥å–å¾—çš„ã€‚
LANG/LANGUGE|æ˜¯å’Œè¯­è¨€ç›¸å…³çš„ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨å¤šç§è¯­è¨€çš„ç”¨æˆ·å¯ä»¥ä¿®æ”¹æ­¤ç¯å¢ƒå˜é‡ã€‚
PS1|æ˜¯åŸºæœ¬æç¤ºç¬¦ï¼Œå¯¹äº root ç”¨æˆ·æ˜¯#ï¼Œå¯¹äºæ™®é€šç”¨æˆ·æ˜¯$ã€‚
PS2|æ˜¯é™„å±æç¤ºç¬¦ï¼Œé»˜è®¤æ˜¯â€œ>â€ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹æ­¤ç¯å¢ƒå˜é‡æ¥ä¿®æ”¹å½“å‰çš„å‘½ä»¤ç¬¦ï¼Œæ¯”å¦‚ä¸‹åˆ—å‘½ä»¤ä¼šå°†æç¤ºç¬¦ä¿®æ”¹æˆå­—ç¬¦ä¸²â€œHello,My NewPrompt :) â€ã€‚ # PS1=" Hello,My NewPrompt :) "
TERM | æœªçŸ¥
HISTCMD | æœªçŸ¥
HISTCONTROL | æœªçŸ¥
HISTIGNORE | æœªçŸ¥
HISTFILE | æœªçŸ¥
HISTFILESIZE | æœªçŸ¥
HISTSIZE | æœªçŸ¥
HISTTIMEFORMAT | æœªçŸ¥
 !! | æœªçŸ¥
 !$ | æœªçŸ¥
 !# | æœªçŸ¥
 !N | æœªçŸ¥
 !-N | æœªçŸ¥

# ä¸‰ã€è¯­æ³•
```bash
if [ "$a" = "root" ]
then
  command 
else
  command 
fi
for file in `ls`
do
  command 
done 
tags=(a b c)
for tag in ${tags[*]}
do
  command 
done 
cat a.conf | grep abc | while read line
do
    command 
done
while condition
do
    command
    # break ï¼šè·³å‡ºæ€»å¾ªç¯
    # continueï¼šè·³å‡ºå½“å‰å¾ªç¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯
done
until condition
do
    command
done
case å€¼ in
  æ¨¡å¼1)
    command
    ;;
  æ¨¡å¼2ï¼‰
    command
    ;;
esac
```
## å››ã€è¡¨è¾¾å¼
* 1. æ–‡ä»¶è¿ç®—ç¬¦

expression | description
--- | ---
-b file	|æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯å—è®¾å¤‡æ–‡ä»¶
-c file	|æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯å­—ç¬¦è®¾å¤‡æ–‡ä»¶
-d file	|æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯ç›®å½•
-f file	|æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯æ™®é€šæ–‡ä»¶ï¼ˆæ—¢ä¸æ˜¯ç›®å½•ï¼Œä¹Ÿä¸æ˜¯è®¾å¤‡æ–‡ä»¶ï¼‰
-g file	|æ£€æµ‹æ–‡ä»¶æ˜¯å¦è®¾ç½®äº† SGID ä½
-k file	|æ£€æµ‹æ–‡ä»¶æ˜¯å¦è®¾ç½®äº†ç²˜ç€ä½(Sticky Bit)
-p file	|æ£€æµ‹æ–‡ä»¶æ˜¯å¦æ˜¯æœ‰åç®¡é“
-u file	|æ£€æµ‹æ–‡ä»¶æ˜¯å¦è®¾ç½®äº† SUID ä½
-r file	|æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯è¯»
-w file	|æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯å†™
-x file |æ£€æµ‹æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œ
-s file	|æ£€æµ‹æ–‡ä»¶æ˜¯å¦ä¸ºç©ºï¼ˆæ–‡ä»¶å¤§å°æ˜¯å¦å¤§äº0)
-e file	|æ£€æµ‹æ–‡ä»¶ï¼ˆåŒ…æ‹¬ç›®å½•ï¼‰æ˜¯å¦å­˜åœ¨

* 2. æ•´æ•°å˜é‡è¡¨è¾¾å¼

expression | description
--- | ---
if [ int1 -eq int2 ]  |  å¦‚æœint1ç­‰äºint2   
if [ int1 -ne int2 ]  |  å¦‚æœä¸ç­‰äº    
if [ int1 -ge int2 ]  |     å¦‚æœ>=
if [ int1 -gt int2 ]  |     å¦‚æœ>
if [ int1 -le int2 ]  |     å¦‚æœ<=
if [ int1 -lt int2 ]  |     å¦‚æœ<

* 3. å­—ç¬¦ä¸²å˜é‡è¡¨è¾¾å¼

expression | description
--- | ---
If  [ $a = $b ]              |   å¦‚æœstring1ç­‰äºstring2å­—ç¬¦ä¸²å…è®¸ä½¿ç”¨èµ‹å€¼å·åšç­‰å·
if  [ $string1 !=  $string2 ]|   å¦‚æœstring1ä¸ç­‰äºstring2       
if  [ -n $string  ]          |   å¦‚æœstring éç©º(é0ï¼‰ï¼Œè¿”å›0(true)  
if  [ -z $string  ]          |   å¦‚æœstring ä¸ºç©º
if  [ $sting ]               |   å¦‚æœstring éç©ºï¼Œè¿”å›0 (å’Œ-nç±»ä¼¼)

* 4. é€»è¾‘è¡¨è¾¾å¼

expression | description
--- | ---
if [ ! è¡¨è¾¾å¼ ]   | é€»è¾‘é
if [ è¡¨è¾¾å¼1 â€“a è¡¨è¾¾å¼2 ]| é€»è¾‘ä¸
if [ è¡¨è¾¾å¼1 â€“o è¡¨è¾¾å¼2 ]| é€»è¾‘æˆ–

# äº”ã€å‚æ•°ä¼ é€’
è·å–å‚æ•°å€¼|å«ä¹‰
---|---
$0 | æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„å’Œæ–‡ä»¶å
basename $0| æ–‡ä»¶çš„æ–‡ä»¶å
dirname $0|æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„
pwd| å½“å‰è·¯å¾„
$(cd `dirname ${conf_path}` && pwd)/${conf_name}|å½“å‰æ–‡ä»¶ç»å¯¹è·¯å¾„
$1 | ä»£è¡¨ä¼ å…¥çš„ç¬¬1ä¸ªå‚æ•°
$n | ä»£è¡¨ä¼ å…¥çš„ç¬¬nä¸ªå‚æ•°
$# | å‚æ•°ä¸ªæ•°
$* | ä»¥ä¸€ä¸ªå•å­—ç¬¦ä¸²æ˜¾ç¤ºæ‰€æœ‰å‘è„šæœ¬ä¼ é€’çš„å‚æ•°ã€‚å¦‚"$*â€œç”¨ã€Œâ€ã€æ‹¬èµ·æ¥çš„æƒ…å†µã€ä»¥"$1 $2 â€¦ $n"çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°
$@ | ä¸$*ç›¸åŒï¼Œä½†æ˜¯ä½¿ç”¨æ—¶åŠ å¼•å·ï¼Œå¹¶åœ¨å¼•å·ä¸­è¿”å›æ¯ä¸ªå‚æ•°ã€‚
$$ | è„šæœ¬è¿è¡Œçš„å½“å‰è¿›ç¨‹å·
$ï¼| åå°è¿è¡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹çš„ID
$? | æ˜¾ç¤ºæœ€åå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ã€‚0è¡¨ç¤ºæ²¡æœ‰é”™è¯¯ï¼Œå…¶ä»–ä»»ä½•å€¼è¡¨æ˜æœ‰é”™è¯¯ã€‚
$* ä¸ $@ çš„åŒºåˆ« | åªæœ‰åœ¨åŒå¼•å·ä¸­ä½“ç°å‡ºæ¥ã€‚å‡è®¾åœ¨è„šæœ¬è¿è¡Œæ—¶å†™äº†ä¸‰ä¸ªå‚æ•° 1ã€2ã€3ï¼Œï¼Œåˆ™ " * " ç­‰ä»·äº â€œ1 2 3â€ï¼ˆä¼ é€’äº†ä¸€ä¸ªå‚æ•°ï¼‰ï¼Œè€Œ â€œ@â€ ç­‰ä»·äº â€œ1â€ â€œ2â€ â€œ3â€ï¼ˆä¼ é€’äº†ä¸‰ä¸ªå‚æ•°ï¼‰ã€‚

## 1. å‚æ•°è‡ªè¿ç®—
`name=/dir1/dir2/dir3/my.file.txt`

è¡¨è¾¾å¼ |  è¯´æ˜
--- | ---
${name:1:4}          | ä»ç¬¬2ä¸ªå¼€å§‹ å¾€åæˆªå–4ä¸ªå­—ç¬¦
${#name}             | è¾“å‡ºä¸ºnameçš„é•¿åº¦
${name#*/}           | åˆ æ‰ç¬¬ä¸€ä¸ª / åŠå…¶å·¦è¾¹çš„å­—ç¬¦ä¸²ï¼šdir1/dir2/dir3/my.file.txt
${name##*/}          | åˆ æ‰æœ€åä¸€ä¸ª /  åŠå…¶å·¦è¾¹çš„å­—ç¬¦ä¸²ï¼šmy.file.txt
${name#*.}           | åˆ æ‰ç¬¬ä¸€ä¸ª .  åŠå…¶å·¦è¾¹çš„å­—ç¬¦ä¸²ï¼šfile.txt
${name##*.}          | åˆ æ‰æœ€åä¸€ä¸ª .  åŠå…¶å·¦è¾¹çš„å­—ç¬¦ä¸²ï¼štxt
${name%/*}           | åˆ æ‰æœ€åä¸€ä¸ª  /  åŠå…¶å³è¾¹çš„å­—ç¬¦ä¸²ï¼š/dir1/dir2/dir3
${name%%/*}          | åˆ æ‰ç¬¬ä¸€ä¸ª /  åŠå…¶å³è¾¹çš„å­—ç¬¦ä¸²ï¼š(ç©ºå€¼)
${name%.*}           | åˆ æ‰æœ€åä¸€ä¸ª  .  åŠå…¶å³è¾¹çš„å­—ç¬¦ä¸²ï¼š/dir1/dir2/dir3/my.file
${name%%.*}          | åˆ æ‰ç¬¬ä¸€ä¸ª  .   åŠå…¶å³è¾¹çš„å­—ç¬¦ä¸²ï¼š/dir1/dir2/dir3/my
${name/dir/path}     | å°†ç¬¬ä¸€ä¸ªdir æ›¿æ¢ä¸ºpathï¼š/path1/dir2/dir3/my.file.txt
${name//dir/path}    | å°†å…¨éƒ¨dir æ›¿æ¢ä¸º pathï¼š/path1/path2/path3/my.file.txt
${name-my.file.txt}  | å‡å¦‚$file æ²’æœ‰è®¾å®šï¼Œåˆ™ä½¿ç”¨my.file.txt ä½œä¼ å›å€¼ã€‚
${name:-my.file.txt} | å‡å¦‚$file æ²’æœ‰è®¾å®šæˆ–ä¸ºç©ºå€¼ï¼Œå‰‡ä½¿ç”¨my.file.txt ä½œå‚³å›å€¼ã€‚
${name+my.file.txt}  | å‡å¦‚$file è®¾ä¸ºç©ºå€¼æˆ–éç©ºå€¼ï¼Œå‡ä½¿ç”¨my.file.txt ä½œå‚³å›å€¼ã€‚
${name:+my.file.txt} | è‹¥$file ä¸ºéç©ºå€¼ï¼Œåˆ™ä½¿ç”¨my.file.txt ä½œå‚³å›å€¼ã€‚
${name=my.file.txt}  | è‹¥$file æ²’è®¾å®šï¼Œåˆ™ä½¿ç”¨my.file.txt ä½œå‚³å›å€¼ï¼ŒåŒæ—¶å°‡$file è³¦å€¼ä¸ºmy.file.txt
${name:=my.file.txt} | è‹¥$file æ²’è®¾å®šæˆ–ä¸ºç©ºå€¼ï¼Œå‰‡ä½¿ç”¨my.file.txt ä½œä¼ å›å€¼ï¼ŒåŒæ™‚å°‡$file è³¦å€¼ä¸ºmy.file.txt
${name?my.file.txt}  | è‹¥$file æ²’è®¾å®šï¼Œå‰‡å°‡my.file.txt è¼¸å‡ºè‡³STDERR
${name:?my.file.txt} | è‹¥$file æ²¡è®¾å®šæˆ–ä¸ºç©ºå€¼ï¼Œåˆ™å°†my.file.txt è¾“å‡ºè‡³STDERR
è®°å¿†çš„æ–¹æ³•ä¸ºï¼š# æ˜¯ å»æ‰å·¦è¾¹ï¼ˆé”®ç›˜ä¸Š#åœ¨ $ çš„å·¦è¾¹ï¼‰ %æ˜¯å»æ‰å³è¾¹ï¼ˆé”®ç›˜ä¸Š% åœ¨$ çš„å³è¾¹ï¼‰ å•ä¸€ç¬¦å·æ˜¯æœ€å°åŒ¹é…ï¼›ä¸¤ä¸ªç¬¦å·æ˜¯æœ€å¤§åŒ¹é…

## 2. æ–‡ä»¶å‚æ•°
æµ‹è¯•æ–¹æ³•:`sh xxx.sh -h 100 -ms abc && sh xxx.sh -t`
```bash
#!/bin/bash
while getopts h:ms option
do 
    case "$option" in
        h)
            echo "option:h, value $OPTARG"
            echo "next arg index:$OPTIND";;
        m)
            echo "option:m"
            echo "next arg index:$OPTIND";;
        s)
            echo "option:s"
            echo "next arg index:$OPTIND";;
        \?)
            echo "Usage: args [-h n] [-m] [-s]"
            echo "-h means hours"
            echo "-m means minutes"
            echo "-s means seconds"
            exit 1;;
    esac
done
shift $((OPTIND-1))
echo $*
echo "*** do something now ***"
```
## 2. ubuntu å¯åŠ¨sambaæœåŠ¡
```
apt install samba
mkdir /data/share
chmod 777 /data/share
åœ¨/etc/samba/smb.confæ–‡ä»¶æœ«å°¾è¿½åŠ 
[home]
   comment = home guest share
   path = /data/share                #æŒ‡å®šå…±äº«è·¯å¾„
   public = yes
   writable = yes
   guest ok = yes
   protocol_vers_map = 3
   directory mask = 0775        #é»˜è®¤åˆ›å»ºç›®å½•çš„æƒé™
   create mask = 0775           #é»˜è®¤åˆ›å»ºæ–‡ä»¶çš„æƒé™
   valid user = root,xc        #å…è®¸è®¿é—®å…±äº«è·¯å¾„çš„ç”¨æˆ·
   write list  = root,xc       #å…è®¸å†™å…¥å…±äº«è·¯å¾„çš„ç”¨æˆ·
   browseable = yes
   available = yes
smbpasswd -a xc
systemctl restart smbd
systemctl enable smbd
ufw allow samba

```
åœ¨macæˆ–è€…windowsç›´æ¥ç”¨ipè¿æ¥
åœ¨linux
```
mount -t cifs //192.168.1.100/data/share /mnt -o username=xc
```

## 3. [åˆ©ç”¨å…¬ç½‘IPåšæœåŠ¡å™¨å±€åŸŸç½‘](https://cloud.tencent.com/developer/article/1832768)
### æœåŠ¡ç«¯
```bash
# å¼€å¯ipv4æµé‡è½¬å‘
echo "net.ipv4.ip_forward = 1" >> /etc/sysctl.conf
sysctl -p
# åˆ›å»ºå¹¶è¿›å…¥WireGuardæ–‡ä»¶å¤¹
mkdir -p /etc/wireguard && chmod 0777 /etc/wireguard && cd /etc/wireguard
umask 077
# ç”ŸæˆæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¯†é’¥å¯¹
wg genkey | tee server_privatekey | wg pubkey > server_publickey
wg genkey | tee client_privatekey | wg pubkey > client_publickey
echo "
[Interface]
PrivateKey = $(cat server_privatekey) # å¡«å†™æœ¬æœºçš„privatekey å†…å®¹
Address = 10.10.10.0/24
PostUp   = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
ListenPort = 50814 # æ³¨æ„è¯¥ç«¯å£æ˜¯UDPç«¯å£
DNS = 8.8.8.8
MTU = 1420
[Peer]
PublicKey =  $(cat client_publickey)  # å¡«å†™å®¢æˆ·ç«¯çš„publickey å†…å®¹
AllowedIPs = 10.10.10.1/32 

[Peer]
PublicKey =  $(cat client_publickey)  # å¡«å†™å®¢æˆ·ç«¯çš„publickey å†…å®¹
AllowedIPs = 10.10.10.2/32 
" > wg0.conf
# è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable wg-quick@wg0
wg-quick up wg0
# wg-quick down wg0
wg  # æŸ¥çœ‹WireGuardè¿è¡ŒçŠ¶æ€
```
### å¼€æœºå¯åŠ¨å‘½ä»¤
è„šæœ¬éœ€è¦å­˜æ”¾åœ¨/etc/systemd/systemä¸‹é¢ï¼Œå¯¹åº”çš„æ–‡ä»¶åä¸ºxxxxx.serviceï¼Œæ–‡ä»¶åå¯ä»¥è‡ªå·±å®šä¹‰ä½†æ˜¯è¦ä¿è¯åç¼€ä¸º.service
```
[Unit]
Description=Custom Service
After=network.target
[Service]
ExecStart=/path/to/command_name

[Install]
WantedBy=default.target
```
æŠŠä¸Šè¿°/path/to/command_name æ›¿æ¢æˆä½ è¦æ‰§è¡Œçš„å‘½ä»¤
chmod 755 /etc/systemd/system/xxxxx.service
##### è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ï¼Œè¿™é‡Œçš„æœåŠ¡åå°±æ˜¯ .service å‰é¢çš„åç§°
systemctl enable xxxxx
##### å¯åŠ¨æœåŠ¡
systemctl start xxxxx
##### æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœåŠ¡å½“å‰çš„çŠ¶æ€
systemctl status xxxxx


### å®¢æˆ·ç«¯
```bash
yum install -y kmod-wireguard wireguard-tools
# apt install -y openresolv wireguard
# brew install -y wireguard-tools
cd /etc/wireguard/
wg genkey | tee privatekey | wg pubkey > client_publickey
echo -e "[Interface]
PrivateKey = $(cat privatekey)
Address = 10.10.10.1/32

[Peer]
PublicKey = $(cat server_publickey)
AllowedIPs = 10.10.10.0/24
Endpoint = å…¬ç½‘IP:å…¬ç½‘ç«¯å£
PersistentKeepalive = 30" > wg0.conf

modprobe wireguard
wg-quick down wg0
wg-quick up wg0
wg
# ç„¶åå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å°±ç»„æˆäº†å±€åŸŸç½‘ï¼Œå±€åŸŸç½‘IPåˆ†åˆ«ä¸º10.10.10.0,10.10.10.1,10.10.10.2
# è®¿é—®å½¼æ­¤çš„æ—¶å€™å°±å¯ä»¥ä½¿ç”¨å±€åŸŸç½‘IP
```

# å…­ã€å‘½ä»¤
## 1. [awk](https://blog.csdn.net/u010502101/article/details/81839519)
å˜é‡ | è¯´æ˜
---  | ---
ARGC       |          å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°
ARGV       |         å‘½ä»¤è¡Œå‚æ•°æ’åˆ—
ENVIRON    |        æ”¯æŒé˜Ÿåˆ—ä¸­ç³»ç»Ÿç¯å¢ƒå˜é‡çš„ä½¿ç”¨
FILENAME   |        awkæµè§ˆçš„æ–‡ä»¶å
FNR        |        æµè§ˆæ–‡ä»¶çš„è®°å½•æ•°
FS         |        è®¾ç½®è¾“å…¥åŸŸåˆ†éš”ç¬¦ï¼Œç­‰ä»·äºå‘½ä»¤è¡Œ -Fé€‰é¡¹
NF         |        æµè§ˆè®°å½•çš„åŸŸçš„ä¸ªæ•°
NR         |        å·²è¯»çš„è®°å½•æ•°
OFS        |        è¾“å‡ºåŸŸåˆ†éš”ç¬¦
ORS        |        è¾“å‡ºè®°å½•åˆ†éš”ç¬¦
RS         |        æ§åˆ¶è®°å½•åˆ†éš”ç¬¦
$0         |å˜é‡æ˜¯æŒ‡æ•´æ¡è®°å½•ã€‚$1è¡¨ç¤ºå½“å‰è¡Œçš„ç¬¬ä¸€ä¸ªåŸŸ,$2è¡¨ç¤ºå½“å‰è¡Œçš„ç¬¬äºŒä¸ªåŸŸ,......ä»¥æ­¤ç±»æ¨ã€‚
$NF        | æ˜¯number 
finally    | è¡¨ç¤ºæœ€åä¸€åˆ—çš„ä¿¡æ¯ï¼Œè·Ÿå˜é‡NFæ˜¯æœ‰åŒºåˆ«çš„ï¼Œå˜é‡NFç»Ÿè®¡çš„æ˜¯æ¯è¡Œåˆ—çš„æ€»æ•°
BEGIN END  | function
```bash
cat /etc/passwd | awk -F: 'BEGIN{print "name, shell"} {print $1,$NF} END{print "hello  world"}'
awk '
function fshow(){
  printf "%-5s : %s\n", $1, $3
}
BEGIN{
  print "å¼€å§‹å¤„ç†..."
}
{
  fshow()
}' file4
```

## 2. tail
å‚æ•°| è¯´æ˜
--- | ---
-f| å¾ªç¯è¯»å–
-q| ä¸æ˜¾ç¤ºå¤„ç†ä¿¡æ¯
-v| æ˜¾ç¤ºè¯¦ç»†çš„å¤„ç†ä¿¡æ¯
-c<æ•°ç›®>| æ˜¾ç¤ºçš„å­—èŠ‚æ•°
-n<è¡Œæ•°>| æ˜¾ç¤ºæ–‡ä»¶çš„å°¾éƒ¨ n è¡Œå†…å®¹
--pid=PID| ä¸-fåˆç”¨,è¡¨ç¤ºåœ¨è¿›ç¨‹ID,PIDæ­»æ‰ä¹‹åç»“æŸ
-q, --quiet, --silent| ä»ä¸è¾“å‡ºç»™å‡ºæ–‡ä»¶åçš„é¦–éƒ¨
-s, --sleep-interval=S| ä¸-fåˆç”¨,è¡¨ç¤ºåœ¨æ¯æ¬¡åå¤çš„é—´éš”ä¼‘çœ Sç§’


## 3. iostat
- ç”¨é€”:æŠ¥å‘Šä¸­å¤®å¤„ç†å™¨(CPU)ç»Ÿè®¡ä¿¡æ¯å’Œæ•´ä¸ªç³»ç»Ÿã€é€‚é…å™¨ã€tty è®¾å¤‡ã€ç£ç›˜å’Œ CD-ROM çš„è¾“å…¥/ è¾“å‡ºç»Ÿè®¡ä¿¡æ¯ã€‚
- è¯­æ³•:iostat [ -c | -d ] [ -k ] [ -t | -m ] [ -V ] [ -x [ device ] ] [ interval [ count ] ]
- æè¿°:iostat å‘½ä»¤ç”¨æ¥ç›‘è§†ç³»ç»Ÿè¾“å…¥/è¾“å‡ºè®¾å¤‡è´Ÿè½½ï¼Œè¿™é€šè¿‡è§‚å¯Ÿä¸å®ƒä»¬çš„å¹³å‡ä¼ é€é€Ÿç‡ç›¸å…³çš„ç‰© ç†ç£ç›˜çš„æ´»åŠ¨æ—¶é—´æ¥å®ç°ã€‚
iostat å‘½ä»¤ç”Ÿæˆçš„æŠ¥å‘Šå¯ä»¥ç”¨æ¥æ›´æ”¹ç³»ç»Ÿé…ç½®æ¥æ›´å¥½åœ°å¹³è¡¡ç‰©ç†ç£ç›˜å’Œé€‚é… å™¨ä¹‹é—´çš„è¾“å…¥/è¾“å‡ºè´Ÿè½½ã€‚

å‚æ•° | è¯´æ˜
--- | ---
-c| ä¸ºæ±‡æŠ¥ CPU çš„ä½¿ç”¨æƒ…å†µ;
-d| ä¸ºæ±‡æŠ¥ç£ç›˜çš„ä½¿ç”¨æƒ…å†µ;
-k| è¡¨ç¤ºæ¯ç§’æŒ‰ kilobytes å­—èŠ‚æ˜¾ç¤ºæ•°æ®; 
-m| è¡¨ç¤ºæ¯ç§’æŒ‰ M å­—èŠ‚æ˜¾ç¤ºæ•°æ®;
-t| ä¸ºæ‰“å°æ±‡æŠ¥çš„æ—¶é—´;
-v| è¡¨ç¤ºæ‰“å°å‡ºç‰ˆæœ¬ä¿¡æ¯å’Œç”¨æ³•;
-x| device æŒ‡å®š è¦ç»Ÿè®¡çš„è®¾å¤‡åç§°ï¼Œé»˜è®¤ä¸ºæ‰€æœ‰çš„è®¾å¤‡;
interval| æŒ‡æ¯æ¬¡ç»Ÿè®¡é—´éš”çš„æ—¶é—´;
count| æŒ‡æŒ‰ç…§è¿™ä¸ªæ—¶é—´é—´éš”ç»Ÿ è®¡çš„æ¬¡æ•°ã€‚

## 4. sar
- sar [options] [-A] [-o file] t [n]
- åœ¨å‘½ä»¤è¡Œä¸­ï¼Œn å’Œ t ä¸¤ä¸ªå‚æ•°ç»„åˆèµ·æ¥å®šä¹‰é‡‡æ ·é—´éš”å’Œæ¬¡æ•°ï¼Œt ä¸ºé‡‡æ ·é—´éš”ï¼Œæ˜¯å¿…é¡»æœ‰çš„å‚æ•°ï¼Œn ä¸ºé‡‡æ ·æ¬¡æ•°ï¼Œæ˜¯å¯é€‰çš„ï¼Œé»˜è®¤å€¼æ˜¯ 1ï¼Œ-o file è¡¨ç¤ºå°†å‘½ä»¤ç»“æœä»¥äºŒè¿›åˆ¶æ ¼å¼å­˜æ”¾åœ¨æ–‡ä»¶ä¸­ï¼Œfile åœ¨æ­¤å¤„ ä¸æ˜¯å…³é”®å­—ï¼Œæ˜¯æ–‡ä»¶åã€‚options ä¸ºå‘½ä»¤è¡Œé€‰é¡¹ï¼Œsar å‘½ä»¤çš„é€‰é¡¹å¾ˆå¤šï¼Œä¸‹é¢åªåˆ—å‡ºå¸¸ç”¨é€‰é¡¹:

params|desc 
--- | ---
-A|æ‰€æœ‰æŠ¥å‘Šçš„æ€»å’Œã€‚
-u|CPU åˆ©ç”¨ç‡
-v|è¿›ç¨‹ã€I èŠ‚ç‚¹ã€æ–‡ä»¶å’Œé”è¡¨çŠ¶æ€ã€‚ 
-d|ç¡¬ç›˜ä½¿ç”¨æŠ¥å‘Šã€‚ 
-r|æ²¡æœ‰ä½¿ç”¨çš„å†…å­˜é¡µé¢å’Œç¡¬ç›˜å—ã€‚ 
-g|ä¸²å£ I/O çš„æƒ…å†µã€‚ 
-b|ç¼“å†²åŒºä½¿ç”¨æƒ…å†µã€‚ 
-a|æ–‡ä»¶è¯»å†™æƒ…å†µã€‚ 
-c|ç³»ç»Ÿè°ƒç”¨æƒ…å†µã€‚ 
-R|è¿›ç¨‹çš„æ´»åŠ¨æƒ…å†µã€‚ 
-y|ç»ˆç«¯è®¾å¤‡æ´»åŠ¨æƒ…å†µã€‚ 
-w|ç³»ç»Ÿäº¤æ¢æ´»åŠ¨ã€‚


## 5. å‹ç¼©æ‰“åŒ…
* linux ä¸‹çš„å‹ç¼©å‘½ä»¤æœ‰ tarã€gzipã€gunzipã€bzip2ã€bunzip2ã€ compressã€uncompressã€zipã€unzipã€rarã€ unrar ç­‰ç­‰
* å‹ç¼©åçš„æ‰©å±•åæœ‰.tarã€.gzã€.tar.gzã€. tgzã€.bz2ã€.tar.bz2ã€.Zã€.tar.Zã€.zipã€.rar 10 ç§ã€‚

æ–‡ä»¶ | å‘½ä»¤
--- | ---
*.tar | tar â€“xvf 
*.gz | gzip -d æˆ–è€… gunzip 
*.tar.gz å’Œ *.tgz | tar â€“xzf 
*.bz2 | bzip2 -d æˆ–è€… bunzip2 
*.tar.bz2 | tar â€“xjf 
*.Z | uncompress 
*.tar.Z | tar â€“xZf 
*.rar | unrar e 
*.zip | unzip 

## 6. yum
```bash
yum -y install --downloadonly  --downloaddir=/tmp/  vlock
yum clean all
yum makecache
```

## 7. python
```bash
curl https://www.python.org/ftp/python/3.8.1/Python-3.8.1.tgz -o python.tgz
yum install -y ncurses-libs zlib-devel mysql-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel libffi-devel
pip3 freeze > require.txt  #
pip3 download -r require.txt -d packages
pip3 install --no-index -f packages -r require.txt
```

## 8. crontab
`* * * * * a.sh >> /app/root.log `
* åˆ† å°æ—¶ æ—¥ æœˆ å‘¨ å…·ä½“çš„å‘½ä»¤
* *è¡¨ç¤ºä»»ä½•æ—¶é—´ 
* ,(é€—å·) è¡¨ç¤ºåˆ†éš”æ—¶æ®µçš„æ„æ€ 5,10,15 * * * * weblogic è¡¨ç¤ºæ¯ä¸ªå°æ—¶çš„5ã€10ã€15åˆ†çš„æ—¶å€™æ‰§è¡Œ
* -ï¼ˆå‡å·ï¼‰ 8ç‚¹åˆ°12ç‚¹çš„20åˆ†é’Ÿéƒ½è¿è¡Œ 20 8-12 * * * weblogic 
* /n è¡¨ç¤ºæ¯éš”å‡ åˆ†é’Ÿ */5 * * * * weblogic 
```bash
# å®‰è£…crontab
yum install vixie-cron
yum install crontabs
# å¯åŠ¨crontabæœåŠ¡
service crond start å¯åŠ¨æœåŠ¡
service crond stop å…³é—­æœåŠ¡
service crond restart é‡å¯æœåŠ¡
service crond reload é‡æ–°è½½å…¥é…ç½®
service crond status æœåŠ¡çŠ¶æ€
# è°ƒåº¦ä»»åŠ¡
crontab -l # åˆ—å‡ºå½“å‰æ‰€æœ‰çš„è°ƒåº¦ä»»åŠ¡
crontab -l -u test # åˆ—å‡ºç”¨æˆ·testçš„æ‰€æœ‰è°ƒåº¦ä»»åŠ¡
crontab -r # åˆ é™¤æ‰€æœ‰è°ƒåº¦ä»»åŠ¡
crontab -e # è¿›è¡Œå¼€å§‹ç¼–å†™è‡ªå·±çš„å®šæ—¶ä»£ç 
# ä¿©ç§æ‰§è¡Œæ–¹å¼
vim /etc/crontab # ç¼–è¾‘
vim test.cron # æ³¨æ„ä¸éœ€è¦æŒ‡å®šç”¨æˆ·
# æ·»åŠ ä»»åŠ¡
crontab test.cron
```

## 9. docker
1. åœ¨çº¿å®‰è£…æŒ‡å®šç‰ˆæœ¬
`curl https://releases.rancher.com/install-docker/18.06.sh | sh`
2. å®‰è£…docker-compose
```bash
sudo curl -L https://github.com/docker/compose/releases/download/1.24.1/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```
3. å®‰è£…docker maching
```bash
base=https://github.com/docker/machine/releases/download/v0.16.0
curl -L $base/docker-machine-$(uname -s)-$(uname -m) >/tmp/docker-machine
sudo install /tmp/docker-machine /usr/local/bin/docker-machine
```
4. å®‰è£…å®¹å™¨å¯è§†åŒ–å¹³å°portainer
`docker pull portainer/portainer && docker run -d -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer`
5. dockerå¸è½½
`sudo yum remove docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-selinux  docker-engine-selinux docker-engine`
6. å¸¸ç”¨å‘½ä»¤
```bash
systemctl start docker
systemctl enable docker
systemctl status docker
docker ps
docker image
docker rmi xxxxx
docker pull xxxxx
docker login hub.docker.com
docker push xxxxx
docker build -t nginx:latest .
docker run -itd --name abc -v ./data:/app/static -p 8080:8080 -e envirment=product nginx:latest
docker exec -it xxxx bash
docker container prune -f
docker logs xxxxx
docker image prune -a
docker history nginx:v2
docker-compose up -d
docker-compose down
docker-compose restart nginx
docker-compose logs nginx -f 100 -t
docker stack deploy --with-registry-auth --prune -c ./docker-compose.yml stack_name
docker stack service ls
docker stack service logs nginx
docker stack config
docker stack restart nginx
docker stack rm nginx
num=`docker ps | grep nginx | wc -l`
while [[ $num -gt 0 ]]
do
echo "${num} containers are stopping, please wait!"
sleep 5
num=`docker ps | grep nlp | wc -l`
done
echo "All stopped"
```

## 10. å…¶ä»–
* node
* pip
* yarn
* npm & cnpm
* wget && wget -p
* xargs -I {} -t  -d  -n
* du -sh *
* df -h
* free -mh
* curl 
* cat
* watch -n 1 -d "uptime"
* ssh
* scp
* touch mv ls rm vi vim top which whoami whereis whatis pod find

# ä¸ƒã€ä½¿ç”¨æŠ€å·§
### 1. æŒ‚è½½nasç›®å½•ï¼š
```bash
export PASSWD=â€˜123456â€™
remote_ip=192.168.1.2
remote_dir=/data
remote_username=''
remote_password=$PASSWD
local_dir=/mydata
options=username=$remote_username,password=$remote_password,iocharset=utf8	
mount -t cifs -o $options //$remote_ip$remote_dir $local_dir
echo '//$remote_ip$remote_dir $local_dir cifs $options 0 0' >> /etc/fstab
```
### 2. å…±äº«ç£ç›˜ç›®å½• 192.168.1.0:/data  ==> 192.168.1.1:/data
```bash
#on 192.168.1.0
yum install -y nfs-utils
echo "/data *(rw,sync,no_root_squash,no_all_squash)" >> /etc/exports
exportfs -r
systemctl enable rpcbind nfs
systemctl start rpcbind nfs
showmount -e localhost

#on 192.168.1.1
yum install -y nfs-utils
systemctl enable rpcbind
systemctl start rpcbind
showmount -e 192.168.1.0
mount -t nfs 192.168.1.0:/data /data
mount
df -h
#192.168.0.110:/data on /data type nfs4 (rw,relatime,sync,vers=4.1,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,port=0,timeo=600,retrans=2,sec=sys,clientaddr=192.168.0.100,local_lock=none,addr=192.168.0.101)
#è¿™è¯´æ˜å·²ç»æŒ‚è½½æˆåŠŸäº†
# å–æ¶ˆæŒ‚è½½
umount -l /data
# å¼€æœºè‡ªåŠ¨æŒ‚è½½
echo "192.168.1.0:/data     /data                   nfs     defaults        0 0" >> /etc/fstab
systemctl daemon-reload
```
```
 mount -t vfat /dev/sdb4 /udisk 
 mount -t nfs 192.168.1.14:/volume2/centos /udisk -o nfsvers=3
```
### 2. ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒå®‰è£…python3
```bash
pip install virtualenv 
virtualenv -h 
virtualenv -p /usr/bin/python3 py3env
source py3env/bin/activate  
pip install anything 
deactivate
```

### 3. å…³é—­é˜²ç«å¢™åŠselinux
```shell
systemctl disable firewalld
systemctl stop firewalld
vi /etc/sysconfig/selinux
  SELINUX=disabled
setenforce 0
getenforce
```

### 4. å…¶ä»–

åŠŸèƒ½ | å‘½ä»¤
--- | ---
æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯| system_profiler SPNVMeDataType SPNetworkLocationDataType SPHardwareDataType
ssh å…å¯†ç™»å½•| ssh-copy-id remote_username@server_ip_address
å½“å‰ç”¨æˆ· | id -nu
ä¸´æ—¶å…³é—­SELinux | setenforce 0
ä¸´æ—¶æ‰“å¼€SELinux | getenforce && setenforce 1
æŸ¥çœ‹SELinuxçŠ¶æ€ | getenforce
å¼€æœºå…³é—­SELinux | ç¼–è¾‘/etc/selinux/configæ–‡ä»¶ï¼Œå°†SELINUXçš„å€¼è®¾ç½®ä¸ºdisabled
åˆ‡æ¢rootç”¨æˆ·    | sudo su
è®¾ç½®vimé»˜è®¤çš„é…ç½®|vim ~/.vimrc
æ¸…é™¤bufferç¼“å­˜|echo 3 > /proc/sys/vm/drop_caches  
åå°è¿è¡Œ| &
æ‰“æ´ |ssh -fN root@ip:port -L localPort:ip:port
è·³æ¿æœºæ‰“æ´ |ssh -fN -L local_port:dest_ip:dest_posrt -p jump_port jump_user@jump_server
é€šè¿‡è·³æ¿æœºä¼ æ–‡ä»¶|scp -o "ProxyJump jump_user@jump_server:jump_port" local_dir dest_user@dest_id:dest_dir
é€šè¿‡è·³æ¿æœºä¼ æ–‡ä»¶|ssh -t -p 10082 xiaoming@jumper.abc.com -fNL 51000:100.0.0.1:22 && scp -r -P 51000 /Users/xiaoming/test xiaoming@127.0.0.1:/tmp/
é€šè¿‡è·³æ¿æœºè¿æ¥|ssh -J jump_user@jump_server:jump_port dest_user@dest_ip
ä¸´æ—¶è®¾ç½® |alias cp='cp â€“i'
å–æ¶ˆç³»ç»Ÿçš„åˆ«å‘½ä»¤|unalias cp
æ°¸ä¹…ç”Ÿæ•ˆ | å†™å…¥~/.bash_profile æˆ–è€…~/.zshrc æˆ–è€… ï½/.bashrc ç„¶å source ~/.bash_profile
æ•°æ®å¢é‡åŒæ­¥ç±»ä¼¼äºscp | rsync -avzP dir1 dir2
å°æ‹¬å·æ˜¯åœ¨æ–°çš„è¿›ç¨‹ä¸­æ‰§è¡Œä¸å½±å“ç°åœ¨çš„è¿›ç¨‹å˜é‡|(cd .. ; echo `pwd`);echo `pwd`
åˆ é™¤å˜é‡| unset name
ç›‘æ§æœåŠ¡å™¨å†…å­˜çŠ¶æ€|vmstat 2
æŸ¥çœ‹å¤šæ ¸CPUè¿è¡Œæƒ…å†µ|mpstat -P ALL
ubuntuå‘å¤–æš´éœ²ç«¯å£|sudo ufw allow 80

### 5. æ¡ˆä¾‹
```bash
export current_path=`pwd`
read -p "Input redis host:" redis_ip
sed -i "s/bind 127.0.0.1/bind ${redis_ip}/" redis.conf
cat /etc/security/limits.conf | grep duser | grep -v "#" | while read line
do
    sed -i "s/${line}/ /"  /etc/security/limits.conf
done
cat a.txt|sort|unique|xargs -n 100 | zip| splite -m 500m - a.tar.gz
cat docker.md|grep -v "#"|awk -F ":" '/image/{print $2":"$3}'|uniq|awk '{split($1,a,"/"); print "docker save "$1"|gzip|> "a[3]".tar.gz"}'|xargs -I {} sh -c {}
sed '/searchtext/s/e.*o/aa/' a.txt # åŒ…å«æŸ¥æ‰¾å’Œæ›¿æ¢
su root -l -c 'echo abc' # è®©rootç”¨æˆ·æ‰§è¡Œ
apt-get install cmatrix # ubuntuä¸‹é»‘å®¢å¸å›½ç‰¹æ•ˆ
apt-get install aview imagemagick # å‘½ä»¤è¡ŒæŸ¥çœ‹å›¾ç‰‡
é¢œè‰²æ ‡è¯†
printf  "\033[32m SUCCESS: yay \033[0m\n";
printf  "\033[33m WARNING: hmm \033[0m\n";
printf  "\033[31m ERROR: fubar \033[0m\n";
mysql -h host -P 000 -u root -p 123456  -e"use test_database; source data_faile; " # -e ä»£è¡¨æ‰§è¡Œsqlè¯­å¥
```
### 6. LinuxæŒ‚è½½Uç›˜
```bash
# æ’ä¸ŠUç›˜ä¹‹å
fdisk -l|grep dev/sda
# /dev/sda4   *         256    15204351     7602048    b  W95 FAT32
# å¯ä»¥çœ‹å‡ºè¿™ä¸ªUç›˜æ˜¯FAT32ç±»å‹
mkdir /udisk
mount -t vfat /dev/sda4 /udisk 
cd /udisk && ls -l
```
### 7. nginxåšsocketä»£ç†
```shell
server {
        listen       8000;
        server_name  localhost;

        location / {
          proxy_pass http://xxxx:8000;
          proxy_http_version 1.1;
          proxy_set_header Upgrade $http_upgrade;
          proxy_set_header Connection "Upgrade";
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
          proxy_read_timeout 86400s;
       }
    }
```
# å…«ã€demo
```shell
#!/bin/bash
while getopts d:i:h:f:o: option
do
  echo $option
  echo #OPTARG
done
shift $((OPTIND-1))
echo $*

# åº“çš„åå­—
function xc() {
    case $1 in
        -v)
          print green 'xc version: 0.0.1';;
        -i|install)
          print green install successed;;
        save)
          if [[ $2 == -f ]]
          then
            print green $3 $4
          elif [[ $2 == -i ]]
          then
            print green $3 $4
          else
            print purple 'Usage: xc save [-f][-i] $file/$image $dir'
          fi
          ;;
        *)
          help;;
    esac
}

# å¸¦é¢œè‰²æ‰“å°
function print() {
  front=2
  back=0
  case $1 in
    black)
      front=0;;
    red)
      front=1;;
    green)
      front=2;;
    yellow)
      front=3;;
    blue)
      front=4;;
    purple)
      front=5;;
    babyblue)
      front=6;;
    *)
      front=7;;
  esac
  echo -e "\033[3$front;4${back}m$2\033[0m"
  #0é»‘è‰²ã€‚1çº¢è‰²ã€‚2ç»¿è‰²ã€‚3é»„è‰²ã€‚4è“è‰²ã€‚5ç´«è‰²ã€‚6æµ…è“è‰²ã€‚7ç°è‰²ã€‚
}

function help() {
  desc=`cat << EOF
    Usage:	xc commond [options] [args]
    A custom function libary write by Super
    Options:
    .    -i  image: save image with image name
    .    -v  version Show the xc version information
    Commands:
    .    install    install a project
    .    save       save images from file or image
    Run 'xc commond --help' for more information on a command.EOF`
  echo "$desc" | while read line; do
    print babyblue "$line"
  done
}

```
```bash

echo -e "\033[31m Start run shell.Please continue to enter or ctrl+C to cancel \033[0m"

PATH=$PATH:/usr/local/bin
if [[ "$(whoami)" != "root" ]]; then
  sudo su
  if [[ "$(whoami)" != "root" ]]; then
    echo "you need a root role ."
    exit 1
  fi
fi


function get_platform() {
    if [ -e /etc/redhat-release ]
    then
      platform=centos
    elif [ -e /etc/lsb-release ]
    then
      platform=ubuntu
    else
      platform=undefined
    fi
    return $platform
}
get_platform
echo 'å½“å‰ç³»ç»Ÿæ˜¯ï¼š$?'

function get_local_ip() {
    ip=`ifconfig -a|grep inet|grep -v 127.0.0.1|grep -v inet6|awk '{print $2}'|tr -d "addr:"`
    ip=`ip addr | awk '/^[0-9]+: / {}; /inet.*global/ {print gensub(/(.*)\/(.*)/, "\\1", "g", $2)}'`
    return $ip
}

# è¯»å–è´¦å·å’ŒIP
function read_input() {
  get_local_ip
  master=$?
  master_user=`whoami`
  read -p "Input worker1 ip:" worker1
  read -p "Input worker1 username:" worker1_user
  read -p "Input worker2 ip:" worker2
  read -p "Input worker2 username:" worker2_user
}

# é…ç½®åŸŸå
function set_host() {
  echo "$master node1" >> /etc/hosts
  echo "$worker1 node2" >> /etc/hosts
  echo "$worker2 node3" >> /etc/hosts
}

# é…ç½®å…å¯†ç™»é™†
function secret_free_login() {
  ssh-keygen -t rsa -N '' -f /root/.ssh/id_rsa
  echo "please input worker1 password:"
  ssh-copy-id -i /root/.ssh/id_rsa.pub $worker1_user@$worker1
  if [ $? -ne 0 ]; then
    echo "worker1 ssh-copy-id failed"
    if [ $worker1_user = root ]
    then
      home1=/root
    else
      home1=/home/$worker1_user
    fi
    echo "please run: scp -i xxx.pem /root/.ssh/id_rsa.pub $worker1_user@$worker1:$home1/.ssh/authorized_keys"
  else
    echo "worker1 free login succeed"
  fi
  echo "please input worker2 password:"
  ssh-copy-id -i /root/.ssh/id_rsa.pub $worker2_user@$worker2
  if [ $? -ne 0 ]; then
    echo "worker2 ssh-copy-id failed"
    if [ $worker2_user = root ]
    then
      home2=/root
    else
      home2=/home/$worker2_user
    fi
    echo "please run: scp -i xxx.pem /root/.ssh/id_rsa.pub $worker2_user@$worker2:$home2/.ssh/authorized_keys"
  else
    echo "worker2 free login succeed"
  fi
}

# ä¿®æ”¹é…ç½®
function edit_config() {
    echo "nothing need to do"
}

# éªŒè¯æ˜¯å¦è”ç½‘
function network() {
    code=`curl -I -s --connect-timeout 1 www.baidu.com -w %{http_code} | tail -n1`
    if [ $code = 200 ]; then
        return 0
    else
        return 1
    fi
}
# å®‰è£…å¸¸ç”¨å‘½ä»¤
function install() {
    network
    if [ $? -eq 0 ];then
      if [[ $platform = centos ]]
      then
        yum install -y wget vim curl unzip docker docker-compose nfs-utils
      else
        apt-get install -y wget vim curl unzip docker docker-compose nfs-utils
      fi
    else
      echo "can not connect internet, install software local now"
      local_install_docker
      install_docker_compose
      install_nfs_utils
    fi
}

# é…ç½®å…±äº«ç£ç›˜
function shared_disk() {
    mkdir -p /data/finone/
    echo "/data *(rw,sync,no_root_squash,no_all_squash)" >> /etc/exports
    exportfs -r
    systemctl enable rpcbind nfs
    systemctl start rpcbind nfs
    showmount -e $master
    mount_disk="sudo su && systemctl enable rpcbind && systemctl start rpcbind && mount -t nfs $master:/data/finone /data/finone"
    ssh $worker1_user@$worker1 /bin/bash -c $mount_disk
    ssh $worker2_user@$worker2 /bin/bash -c $mount_disk
}

# é…ç½®swarmé›†ç¾¤
function swarm() {
    docker swarm leave --force
    join="sudo su && "`docker swarm init | grep "docker swarm join --token "`
    ssh $worker1_user@$worker1 /bin/bash -c $join
    ssh $worker2_user@$worker2 /bin/bash -c $join
    docker node ls
}

# è½½å…¥é•œåƒ
function load_images() {
    docker load -i *.tar
    docker images
}

# å¯åŠ¨æœåŠ¡
function start() {
    docker stack deploy --with-registry-auth -c ./docker-compose.yml ray
}

# åœæ­¢æœåŠ¡
function stop() {
  docker stack rm ray
}

# æŸ¥çœ‹ä¿¡æ¯
function info() {
    docker stack ls
    docker ps
    docker service ls
}

# run in worker
function run_in_worker() {
  install
  load_images
}

# æ€»å¯åŠ¨
function run() {
    read_input
    set_host
    secret_free_login
    scp /etc/hosts $worker1_user@$worker1:/etc/hosts
    scp /etc/hosts $worker2_user@$worker2:/etc/hosts
    install
    shared_disk
    load_images
    edit_config
    ssh worker1_user@worker1 /bin/bash -c "cd /data/finone && source run.sh && run_in_worker"
    ssh worker2_user@worker2 /bin/bash -c "cd /data/finone && source run.sh && run_in_worker"
    swarm
    start
    info
    echo "Congratulations every thine is OK! ğŸ‘ğŸ‘ğŸ‘ğŸ‰ğŸ‰ğŸ‰ğŸ’ğŸ’ğŸ’"
}

function install_nfs_utils() {
    rpm -ivh *.rpm --nodeps
}

function install_docker_compose(){
    # curl -L "https://github.com/docker/compose/releases/download/v2.4.0/docker-compose-$(uname -s)-$(uname -m)" > docker-compose
    chmod +x docker-compose
    mv docker-compose /usr/local/bin/docker-compose
    docker-compose --version
    echo "docker-compose installed successfully."
}

function local_install_docker() {
    # wget https://download.docker.com/linux/static/stable/x86_64/docker-19.03.7.tgz > docker.tgz
    tar -xzvf docker.tgz
    mv docker/* /usr/local/bin
    docker_service=`cat << EOF
        [Unit]
        Description=Docker Application Container Engine
        Documentation=https://docs.docker.com
        After=network-online.target firewalld.service
        Wants=network-online.target

        [Service]
        Type=notify
        # ExecStartçš„å¯åŠ¨å¯é€‰å‚æ•°ï¼Œå¯é€šè¿‡dockerd --helpæŸ¥çœ‹
        ExecStart=/usr/local/bin/dockerd -H unix://var/run/docker.sock --data-root=/home/root/data/docker
        ExecReload=/bin/kill -s HUP $MAINPID
        TimeoutSec=0
        RestartSec=2
        Restart=always
        StartLimitBurst=3
        StartLimitInterval=60s
        LimitNOFILE=infinity
        LimitNPROC=infinity
        LimitCORE=infinity
        TasksMax=infinity
        Delegate=yes
        KillMode=process

        [Install]
        WantedBy=multi-user.target
        EOF`
    echo > /etc/systemd/system/docker.service
    echo docker_service | while read line
    do
      echo $line >> /etc/systemd/system/docker.service
    done
    systemctl daemon-reload
    systemctl start docker
    systemctl enable docker
    docker -v
    docker images
    docker ps
    echo "docker installed successfully."
}
```
## å®¶å±…æ™ºèƒ½
``` python
import urequests
from machine import Pin
import time
pin = Pin(2, Pin.in)
pin2 = Pin(4, Pin.out)

state = 0
while 1:
    s = pin.value()
    if s!=state:
        state = s
        if s == 1:
            pin2.ON()
            urequests.get('http://localhost:8000/api/ping?state=' + s).json()
            print('æ¥äººäº†')
        else:
            pin2.OFF()
            urequests.get('http://localhost:8000/api/ping?state=' + s).json()
            print('æ²¡æœ‰äºº')
    time.sleep(1)



```
